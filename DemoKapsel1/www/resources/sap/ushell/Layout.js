(function(){"use strict";jQuery.sap.declare("sap.ushell.Layout");var C=function(s){this.init(s);};C.prototype={settings:null,tileWidth:0,tileHeight:0,tileMargin:0,curTouchMatrixCords:null,tilesInRow:null,groupsList:null,item:null,matrix:null,tiles:null,collisionLeft:false,startGroup:null,currentGroup:null,endGroup:null,init:function(s){this.curTouchMatrixCords={column:null,row:null};this.endGroup=null;this.item=null;this.matrix=null;this.tiles=null;this.collisionLeft=false;this.startGroup=null;this.currentGroup=null;this.groupsList=null;this.settings=this.settings||s;jQuery.extend(this,this.settings);this.tileWidth=this.thisLayout.styleInfo.tileWidth;this.tileHeight=this.thisLayout.styleInfo.tileHeight;this.tileMargin=this.thisLayout.styleInfo.tileMarginWidth;},moveDraggable:function(m,a){var i=this.detectCollision(m,a);if(i){this.changePlaceholder();}},layoutStartCallback:function(e){this.init();this.item=sap.ui.getCore().byId(e.id);this.tilesInRow=this.thisLayout.getTilesInRow();this.groupsList=this.thisLayout.getGroups();this.startGroup=this.currentGroup=this.item.getParent();},layoutEndCallback:function(){if(!this.tiles){return{tile:this.item};}var r={srcGroup:this.startGroup,dstGroup:this.endGroup,tile:this.item,dstTileIndex:this.tiles.indexOf(this.item),tileMovedFlag:true};return r;},compareArrays:function(a,b){if(a.length!==b.length){return false;}for(var i=0;i<a.length;i++){if(a[i]!==b[i]){return false;}}return true;},reorderTilesView:function(t,g){this.tiles=t;this.matrix=this.thisLayout.organizeGroup(t);this.thisLayout.applyTilesPositions(g,this.matrix);},changeTilesOrder:function(i,r,t,m){var n=t.slice(0);var d=n.indexOf(i);if(d>-1){n.splice(d,1);}if(r){n.splice(n.indexOf(r),0,this.item);}else{n.push(i);}if(this.currentGroup==this.endGroup){if(this.compareArrays(t,n)){return false;}var a=this.thisLayout.organizeGroup(n);var c=this.thisLayout.getTilePositionInMatrix(i,m);var b=this.thisLayout.getTilePositionInMatrix(i,a);if((c.row==b.row)&&(c.col==b.col)){return false;}}this.tiles=n;this.currentGroup=this.endGroup;return n;},removePlusTile:function(m){var n=[];var c=m[0].length;for(var r=0;r<m.length;r++){n.push([]);for(var a=0;a<c;a++){var i=m[r][a]&&m[r][a]instanceof sap.ushell.ui.launchpad.PlusTile;n[r].push(i?undefined:m[r][a]);}}return n;},changePlaceholder:function(){var t=(this.endGroup!==this.currentGroup);if(t){var c=this.thisLayout.getGroupTiles(this.currentGroup);if(this.currentGroup===this.startGroup){c=c.slice(0);c.splice(c.indexOf(this.item),1);}var a=this.thisLayout.organizeGroup(c);this.thisLayout.applyTilesPositions(this.currentGroup,a);this.tiles=this.thisLayout.getGroupTiles(this.endGroup).slice(0);if(this.startGroup===this.endGroup){this.tiles.splice(this.tiles.indexOf(this.item),1);}this.matrix=this.thisLayout.organizeGroup(this.tiles);this.endGroup.getInnerContainerDomRef().appendChild(this.item.getDomRef());this.currentGroup=this.endGroup;}var b=this.removePlusTile(this.matrix);var d=this.tiles||this.thisLayout.getGroupTiles(this.endGroup).slice(0);var n;if(b[this.curTouchMatrixCords.row]&&typeof b[this.curTouchMatrixCords.row][this.curTouchMatrixCords.column]=="object"){var r=b[this.curTouchMatrixCords.row][this.curTouchMatrixCords.column];var e=d.indexOf(r);if(this.rightToLeft){this.collisionLeft=!this.collisionLeft;}if(this.collisionLeft){r=d[e+1];}if(r===this.item){if(t){this.reorderTilesView(d,this.endGroup);}return;}n=this.changeTilesOrder(this.item,r,d,b);if(n){this.reorderTilesView(n,this.endGroup);}return;}var m=this.findTileToPlaceAfter(b,d);if(d[m+1]==this.item){return;}n=this.changeTilesOrder(this.item,d[m+1],d,b);if(n){this.reorderTilesView(n,this.endGroup);}},findTileToPlaceAfter:function(c,t){var x=(this.thisLayout.rightToLeft)?0:this.curTouchMatrixCords.column,I=(this.thisLayout.rightToLeft)?1:-1,m=0,r=c[0].length;for(var i=this.curTouchMatrixCords.row;i>=0;i--){for(var j=x;j>=0&&j<r;j+=I){if(!c[i]||typeof c[i][j]!="object"){continue;}var a=t.indexOf(c[i][j]);m=a>m?a:m;}x=c[0].length-1;}return m;},detectCollision:function(m,a){var r,b,c,d=false;for(var i=0;i<this.groupsList.length;i++){var e=this.groupsList[i].getInnerContainerDomRef();r=e.getBoundingClientRect();b=!(r.right<m||r.left>m);c=!(r.bottom<a||r.top>a);if(b&&c){d=this.groupsList[i];break;}}var f=jQuery.extend({},this.curTouchMatrixCords);if(!d||d.getIsGroupLocked()){return false;}if(d){this.matrix=this.matrix||this.thisLayout.organizeGroup(this.thisLayout.getGroupTiles(d));var g=(r.top*(-1)+a)/(this.tileHeight+this.tileMargin);var h=(r.left*(-1)+m)/(this.tileWidth+this.tileMargin);f={row:Math.floor(g),column:Math.floor(h)};}if((d===this.endGroup)&&(f.column===this.curTouchMatrixCords.column)&&(f.row===this.curTouchMatrixCords.row)){return false;}this.collisionLeft=(f.column-this.curTouchMatrixCords.column)>0;if(f.column===this.curTouchMatrixCords.column){this.collisionLeft=false;}jQuery.extend(this.curTouchMatrixCords,f);this.endGroup=d;return true;}};var L=function(){};L.prototype={init:function(c){var t=function(){var s=this.getStyleInfo(this.container);if(s.tileWidth>0){this.isInited=true;this.reRenderGroupsLayout();this.layoutEngine=new C({thisLayout:this});return;}setTimeout(t,100);}.bind(this);this.cfg=c||this.cfg;this.minTilesinRow=2;this.maxTilesInRow=8;this.rightToLeft=sap.ui.getCore().getConfiguration().getRTL();this.container=this.cfg.container||document.getElementById('dashboardGroups');t();},getLayoutEngine:function(){return this.layoutEngine;},getStyleInfo:function(c){var t=document.createElement('div'),a=c.getAttribute('id');c=a?document.getElementById(a):c;t.className="sapUshellTile";t.setAttribute('style','position: absolute; visibility: hidden;');c.appendChild(t);var b=window.getComputedStyle(t);var i={"tileMarginHeight":parseInt(b.marginBottom,10)+parseInt(b.marginTop,10),"tileMarginWidth":parseInt(b.marginLeft,10)+parseInt(b.marginRight,10),"tileWidth":t.offsetWidth,"tileHeight":t.offsetHeight,"containerWidth":c.offsetWidth};t.parentNode.removeChild(t);return i;},getGroups:function(){return this.cfg.getGroups();},getTilesInRow:function(){return this.tilesInRow;},setTilesInRow:function(t){this.tilesInRow=t;},checkPlaceForTile:function(t,m,a,l){if(typeof m[a.y]==="undefined"){m.push(new Array(m[0].length));}if(typeof m[a.y+1]==="undefined"){m.push(new Array(m[0].length));}if(typeof m[a.y][a.x]!=="undefined"){return false;}var p=jQuery.extend({},a);if(!t.getLong()&&!t.getTall()){return[p];}var c=[p];if(t.getTall()){if((p.y+1)>l||typeof m[p.y+1][p.x]!=="undefined"){return false;}c.push({y:p.y+1,x:p.x});}if(t.getLong()){if((a.x+1)>=m[0].length||(typeof m[p.y][p.x+1]!=="undefined")){return false;}c.push({y:p.y,x:p.x+1});}if(t.getTall()&&t.getLong()){if(typeof m[p.y+1][p.x+1]!=="undefined"){return false;}c.push({y:p.y+1,x:p.x+1});}return c;},placeTile:function(t,m,c){for(var i=0;i<c.length;i++){m[c[i].y][c[i].x]=t;}},getTilePositionInMatrix:function(t,m){for(var r=0;r<m.length;r++){for(var c=0;c<m[0].length;c++){if(m[r][c]==t){return{row:r,col:c};}}}return false;},fillRowsInLine:function(m,t,s,e){if(!t.length){return 0;}var p=[],c,i;var a=e||s;for(i=s;i<=a&&t.length;i++){for(var j=0;j<m[0].length&&t.length;j++){c=this.checkPlaceForTile(t[0],m,{x:j,y:i},e);if(c){this.placeTile(t[0],m,c);p.push(t.shift());}}}var b=1,h;for(i=0;i<p.length;i++){h=p[i].getTall()?2:1;b=h>b?h:b;}return b;},organizeGroup:function(t){var a=t.slice(0);var b=[];var c=0;b.push(new Array(this.tilesInRow));while(a.length){var l=this.fillRowsInLine(b,a,c);c++;if(l<=1){continue;}this.fillRowsInLine(b,a,c,c+l-2);c+=(l-1)||1;}if(this.rightToLeft){for(var i=0;i<b.length;i++){b[i].reverse();}}b=this.cleanRows(b);return b;},cleanRows:function(t){var d=false;for(var r=t.length-1;r>0&&!d;r--){for(var c=0;c<t[r].length&&!d;c++){if(typeof t[r][c]==="object"){d=true;}}if(!d){t.pop();}}return t;},applyTilesPositions:function(g,m){var p=[];var s=0;var i;for(i=0;i<m.length;i++){var e=true;for(var j=0;j<m[0].length;j++){if(typeof m[i][j]=="object"&&p.indexOf(m[i][j])<0){var t=m[i][j];if(this.rightToLeft){s=this.tilesInRow-1;if(t.getLong()){s--;}}var a=(j-s)*this.styleInfo.tileWidth+(j-s)*this.styleInfo.tileMarginWidth;var b=(i*this.styleInfo.tileHeight)+(i*this.styleInfo.tileMarginHeight);var c="translate3d("+a+"px,"+b+"px,0px)";var d="translate("+a+"px,"+b+"px)";var f=t.getDomRef();if(f){var h=f.style;h.webkitTransform=c;h.transform=c;h.msTransform=d;}t.data('layoutPosition',{translate3D:c,translate2D:d});p.push(t);}if(typeof m[i][j]!=="undefined"){e=false;}}if(e){m.splice(i,1);i--;}}var k=m.length||1;var l=(k*(this.styleInfo.tileHeight+this.styleInfo.tileMarginHeight))+'px';g.data('containerHeight',l);var n=g.getInnerContainerDomRef();if(n){n.style.height=l;}if(this.cfg.isLockedGroupsCompactLayoutEnabled&&g.getIsGroupLocked()&&m.length>0){var o=g.getDomRef().parentElement;if(this.cfg.isLockedGroupsCompactLayoutEnabled()){var q=m[0].length;for(i=0;i<m[0].length;i++){if(!m[0][i]){q=i;break;}}var r=q*(this.styleInfo.tileWidth+this.styleInfo.tileMarginWidth);g.getDomRef().style.width="auto";o.style.width=r+"px";o.style.display="inline-block";}else{g.getDomRef().style.width="";o.style.width="";o.style.display="";}}},calcTilesInRow:function(c,t,a){var b=Math.floor(c/(t+a));if(b<=this.maxTilesInRow){b=(b<this.minTilesinRow?this.minTilesinRow:b);}else{b=this.maxTilesInRow;}return b;},reRenderGroupLayout:function(g,t){t=t||this.getGroupTiles(g);var a=this.organizeGroup(t);this.applyTilesPositions(g,a);},getGroupTiles:function(g){var t=g.getTiles();if(t.length>=1&&g.getShowPlaceholder()){t.push(g.oPlusTile);}return t;},reRenderGroupsLayout:function(g,o){if(!this.isInited){return;}var s=this.getStyleInfo(this.container);if(!s.tileWidth){return;}if(o&&JSON.stringify(s)==JSON.stringify(this.styleInfo)){return;}this.styleInfo=s;this.tilesInRow=this.calcTilesInRow(s.containerWidth,s.tileWidth,s.tileMarginWidth);g=g||this.getGroups();for(var i=0;i<g.length;i++){this.reRenderGroupLayout(g[i]);}}};sap.ushell.Layout=new L();})();
