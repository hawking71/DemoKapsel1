(function(g){"use strict";jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchHelper');jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchResultListFormatter');jQuery.sap.require('sap.ushell.renderers.fiori2.search.INAV2SearchFacetsFormatter');jQuery.sap.require('sap.ushell.renderers.fiori2.search.FacetItem');jQuery.sap.require('sap.ushell.renderers.fiori2.search.Facet');jQuery.sap.require('sap.ui.thirdparty.hasher');jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchTabStripsFormatter');var s=g.sap;var S=s.ushell.renderers.fiori2.search.SearchHelper;var a=s.ushell.renderers.fiori2.search.SearchResultListFormatter;var T=s.ushell.renderers.fiori2.search.SearchTabStripsFormatter.Formatter;var c=g.console;s.ui.model.json.JSONModel.extend("sap.ushell.renderers.fiori2.search.SearchModel",{SUGGESTION_TYPE_APPS:'apps',SUGGESTION_TYPE_BO:'businessobject',SUGGESTION_TYPE_DATASOURCE:'datasource',constructor:function(p){var b=this;p=p||{};s.ui.model.json.JSONModel.prototype.constructor.apply(b,[]);b.urlParameters=b.parseUrlParameters();b.updateUrl=p.updateUrl!==undefined?p.updateUrl:true;b.setSizeLimit(200);b.sina=s.ushell.Container.getService("Search").getSina();b.query=b.sina.createPerspectiveQuery({templateFactsheet:true});b.suggestionQuery=b.sina.createSuggestionQuery();b.resetFilterConditions(false);b.createAllAndAppDataSource();b.doSuggestion=S.delayedExecution(b.doSuggestion,400);b.suggestionQuery.getResultSet=S.refuseOutdatedRequests(b.suggestionQuery.getResultSet,'suggestions');b.suggestApplications=S.refuseOutdatedRequests(b.suggestApplications,'suggestions');b.suggestDataSources=S.refuseOutdatedRequests(b.suggestDataSources,'suggestions');b.query.getResultSet=S.refuseOutdatedRequests(b.query.getResultSet,'search');b.searchApplications=S.refuseOutdatedRequests(b.searchApplications,'search');b.oFacetFormatter=new s.ushell.renderers.fiori2.search.INAV2SearchFacetsFormatter();b.tabStripFormatter=new T();b.appTopDefault=20;b.boTopDefault=10;b.setProperty('/searchBoxTerm','');b.setProperty('/lastSearchTerm',null);b.setProperty('/dataSource');b.setProperty('/lastDataSource',null);b.setProperty('/top',10);b.setProperty('/lastTop',10);b.setProperty('/skip',0);b.setProperty('/lastSkip',0);b.setProperty('/results',[]);b.setProperty('/appResults',[]);b.setProperty('/boResults',[]);b.setProperty('/count',0);b.setProperty('/boCount',0);b.setProperty('/appCount',0);b.setProperty('/facets',[]);b.setProperty('/filterConditions',[]);b.setProperty('/dataSources',[b.allDataSource,b.appDataSource]);b.setProperty('/recentDataSources',[]);b.setProperty('/businessObjSearchEnabled',true);b.setProperty('/resultsVisibility',true);b.setProperty('/appsVisibility',true);b.setProperty('/facetVisibility',false);b.setProperty('/lastFacetVisibility',false);b.resetDataSource(false);var d={desktop:{appSuggestion:3,normalSuggestion:7,singleAppSuggestion:7,dataSourceSuggestion:2},phone:{appSuggestion:3,normalSuggestion:5,singleAppSuggestion:5,dataSourceSuggestion:2}};b.deviceSuggestionLimits=jQuery.device.is.phone?d.phone:d.desktop;b.initBusinessObjSearch();},parseUrlParameters:function(){var u=s.ushell.Container.getService("URLParsing");var p=u.parseParameters(window.location.search);var n={};for(var k in p){var v=p[k];if(v.length!==1){continue;}v=v[0];if(typeof v!=='string'){continue;}n[k.toLowerCase()]=v.toLowerCase();}return n;},setProperty:function(n,v){var b=this;s.ui.model.json.JSONModel.prototype.setProperty.apply(this,arguments);switch(n){case'/boResults':case'/appResults':b.calculateResultList();break;case'/appCount':case'/boCount':b.setProperty('/count',b.getProperty('/appCount')+b.getProperty('/boCount'));break;}},calculateResultList:function(){var b=this;var r=[];var d=b.getProperty('/boResults');if(d&&d.length){r.push.apply(r,d);}var t=b.getProperty('/appResults');if(t&&t.length>0){var e={type:'appcontainer',tiles:t};if(r.length>0){if(r.length>3){r.splice(3,0,e);}else{r.splice(0,0,e);}}else{r=[e];}}s.ui.model.json.JSONModel.prototype.setProperty.apply(this,['/results',r]);},initBusinessObjSearch:function(){var b=this;if(!b.isBusinessObjSearchConfigured()){b.setProperty('/businessObjSearchEnabled',false);return;}b.sina.sinaSystem().getServerInfo().done(function(){b.loadDataSources();}).fail(function(){b.setProperty('/businessObjSearchEnabled',false);});},loadDataSources:function(){var b=this;b.getServerDataSources().done(function(d){if(!jQuery.isArray(d)){d=[];}d=d.slice();d.splice(0,0,b.appDataSource);d.splice(0,0,b.allDataSource);b.setProperty("/dataSources",d);b.updateDataSourceList(b.getDataSource());var e=b.getDataSource();b.setProperty("/dataSource",{});b.setProperty("/dataSource",e);});},getServerDataSources:function(){var b=this;if(b.getDataSourcesDeffered){return b.getDataSourcesDeffered;}b.getDataSourcesDeffered=b.sina.sinaSystem().getServerInfo().then(function(d){var e=d.rawServerInfo.ServerInfo.SystemId;var f=d.rawServerInfo.ServerInfo.Client;var h=e+f+"~ESH_CONNECTOR~";var i=b.sina.createDataSource({objectName:h,packageName:{label:"ABAP",value:"ABAP"},type:"Connector",label:""});var j=b.sina.createPerspectiveQuery();j.setDataSource(i);j.setSearchTerms("*");j.setTop(1000);j.setOrderBy({orderBy:'DESCRIPTION',sortOrder:'ASC'});return j.getResultSet();}).then(function(r){var e=r.searchresultset.getElements();var d=jQuery.map(e,function(f){return b.sina.createDataSource({objectName:{label:f.OBJECT_NAME.value,value:f.OBJECT_NAME.value},packageName:{label:"ABAP",value:"ABAP"},schemaName:"",type:{label:'View',value:'View'},label:f.DESCRIPTION.value===null?f.OBJECT_NAME.value:f.DESCRIPTION.value});});return b.removeDuplicateDataSources(d);});return b.getDataSourcesDeffered;},removeDuplicateDataSources:function(d){var f=[];var m={};for(var i=0;i<d.length;++i){var b=d[i];if(m[b.objectName.value]){continue;}m[b.objectName.value]=true;f.push(b);}return f;},isBusinessObjSearchConfigured:function(){try{var b=window['sap-ushell-config'].renderers.fiori2.componentData.config;return b.searchBusinessObjects!=='hidden';}catch(e){return true;}},isBusinessObjSearchEnabled:function(){return this.getProperty('/businessObjSearchEnabled');},isFacetSearchEnabled:function(){if(this.urlParameters.eshfacets==='true'){return true;}return false;},searchApplications:function(b,t,d){return s.ushell.Container.getService("Search").queryApplications({searchTerm:b,searchInKeywords:true,top:t,skip:d});},suggestApplications:function(b){return s.ushell.Container.getService("Search").queryApplications({searchTerm:b});},suggestDataSources:function(b,l){var d=this;var e=[];return d.getServerDataSources().then(function(f){if($.inArray(d.appDataSource,f)<0){f.unshift(d.appDataSource);}if($.inArray(d.allDataSource,f)<0){f.unshift(d.allDataSource);}var t=new S.Tester(b);var o;var h;for(var i=0;i<f.length;++i){var j=f[i];if(j.objectName.value===d.getDataSource().objectName.value){continue;}o=t.test(j.label);if(o.bMatch===true){h={};h.label='<i>'+s.ushell.resources.i18n.getText("searchInPlaceholder",o.sHighlightedText)+'</i>';h.labelRaw='';h.dataSource=j;h.type=d.SUGGESTION_TYPE_DATASOURCE;e.push(h);if(e.length===l){break;}}}return e;});},createAllAndAppDataSource:function(){this.allDataSource=this.sina.getRootDataSource();this.allDataSource.label=s.ushell.resources.i18n.getText("label_all");this.appDataSource=this.sina.createDataSource({objectName:{label:"Apps",value:"$$APP$$"},packageName:{label:"ABAP",value:"ABAP"},type:"Category",label:s.ushell.resources.i18n.getText("label_apps")});},isAllCategory:function(){var d=this.getProperty("/dataSource");if((d&&d.objectName&&d.objectName.value&&d.objectName.value.toLowerCase()==="$$all$$")||(d&&d.objectName&&d.objectName.toLowerCase&&d.objectName.toLowerCase()==="$$all$$")){return true;}return false;},isAppCategory:function(){var d=this.getProperty("/dataSource");if(d&&d.objectName&&d.objectName.value==="$$APP$$"){return true;}return false;},abortSuggestions:function(){this.setProperty("/suggestions",[]);this.doSuggestion.abort();S.abortRequests('suggestions');},doSuggestion:function(){var b=this;var d=b.getProperty("/searchBoxTerm");if(d.length===0){return;}b.setProperty("/suggestions",[]);S.abortRequests('suggestions');if(b.isBusinessObjSearchEnabled()){if(d.length>=3||!b.isAllCategory()){b.doNormalSuggestions(d);}}if(b.isAllCategory()||b.isAppCategory()){b.doAppSuggestions(d);}if(b.isBusinessObjSearchEnabled()){b.doDataSourceSuggestions(d);}},doAppSuggestions:function(b){var d=this;var e=d.suggestApplications(b).done(function(r){var f=r.getElements();jQuery.each(f,function(j,k){k.type=d.SUGGESTION_TYPE_APPS;k.dataSource=d.appDataSource;});var h;if(d.isBusinessObjSearchEnabled()&&d.isAllCategory()){h=d.deviceSuggestionLimits.appSuggestion;}else{h=d.deviceSuggestionLimits.singleAppSuggestion;}f=f.slice(0,h);var i=d.getProperty("/suggestions");i.unshift.apply(i,f);d.setProperty("/suggestions",i);});},doNormalSuggestions:function(b){var d=this;d.suggestionQuery.setSuggestionTerm(b);d.suggestionQuery.setDataSource(d.getProperty("/dataSource"));d.suggestionQuery.getResultSet().done(function(r){var n=d.assembleNormalSuggestionItems(r,b);for(var i=0;i<n.length;i++){var e=n[i];if(d.isAllCategory()&&e.dataSourceLabel){e.label=e.label+" <i>in "+e.dataSourceLabel+"</i>";}}var f=d.getProperty("/suggestions");f.push.apply(f,n);d.setProperty("/suggestions",f);});},assembleNormalSuggestionItems:function(r,b){var d=this;var e=r.getElements();var f=[];for(var i=0;i<e.length;i++){var h=e[i];var j;if(i===0){j=h.labelRaw;}if(h.attribute.value!=="$$AllAttributes$$"){continue;}h.dataSource.label=h.dataSource.objectName.label;h.dataSource.objectName.label=h.dataSource.objectName.value;h.dataSource.type.label='View';h.dataSource.type.value='View';h.dataSource.packageName.label='ABAP';h.dataSource.packageName.value='ABAP';if(d.isAllCategory()){if(h.dataSource.getObjectName().value==="$$AllDataSources$$"){h.dataSource=d.allDataSource;}else{if(j===h.labelRaw){h.dataSourceLabel=h.dataSource.getLabel();}else{continue;}}}else{if(h.dataSource.getObjectName().value==="$$AllDataSources$$"){h.dataSource=d.getProperty("/dataSource");h.dataSourceLabel=h.dataSource.getLabel();}else{continue;}}if(jQuery.type(h.label)==="string"&&h.label.length<1){h.label=h.labelRaw;}h.type=d.SUGGESTION_TYPE_BO;f.push(h);if(d.deviceSuggestionLimits.normalSuggestion===f.length){break;}}return f;},doDataSourceSuggestions:function(b){var d=this;var e=function(f){for(var i=0;i<f.length;++i){var h=f[i];if(h.type===d.SUGGESTION_TYPE_APPS){continue;}return i;}return f.length;};d.suggestDataSources(b,d.deviceSuggestionLimits.dataSourceSuggestion).done(function(f){var h=d.getProperty("/suggestions");var i=[];i.push(e(h));i.push(0);i.push.apply(i,f);h.splice.apply(h,i);d.setProperty("/suggestions",h);});},addFilterCondition:function(f,b){var d=this,e=f.filterCondition;function h(f){var n=d.getProperty("/filterConditions");n.push(f);d.setProperty("/filterConditions",n);}if(e.attribute||e.conditions){if(!d.query.getFilter().hasFilterCondition(e)){d.query.addFilterCondition(e);h(f);}if(!d.suggestionQuery.getFilter().hasFilterCondition(e)){d.suggestionQuery.addFilterCondition(e);}d.filterChanged=true;}else{d.setDataSource(e,false,{source:"facets"});}if(b||b===undefined){d._searchFireQuery();}},removeFilterCondition:function(f,b){var d=this,e=f.filterCondition;function r(f){var n=d.getProperty("/filterConditions");var i=d.getProperty("/filterConditions").length;while(i--){var h=d.getProperty("/filterConditions")[i].filterCondition;if(h.equals(f.filterCondition)){n.splice(i,1);break;}}d.setProperty("/filterConditions",n);}if(e.attribute){r(f);d.query.removeFilterCondition(e.attribute,e.operator,e.value);d.suggestionQuery.removeFilterCondition(e.attribute,e.operator,e.value);}else if(e.conditions){r(f);d.query.getFilter().removeFilterConditionGroup(e);d.suggestionQuery.getFilter().removeFilterConditionGroup(e);}else{d.setDataSource(e,false);}d.filterChanged=true;if(b||b===undefined){d._searchFireQuery();}},hasFilterCondition:function(f){return this.query.getFilter().hasFilterCondition(f);},resetFilterConditions:function(f){var b=this;b.query.resetFilterConditions();b.suggestionQuery.resetFilterConditions();b.setProperty("/filterConditions",[]);b.query.addFilterCondition('$$RenderingTemplatePlatform$$','=','html');b.query.addFilterCondition('$$RenderingTemplateTechnology$$','=','Tempo');b.query.addFilterCondition('$$RenderingTemplateVariant$$','=','');b.query.addFilterCondition('$$RenderingTemplateType$$','=','ItemDetails');b.query.addFilterCondition('$$RenderingTemplateType$$','=','ResultItem');if(f||f===undefined){b._searchFireQuery();}},getFacets:function(){var b=this;return b.getProperty('/facets');},getTop:function(){return this.getProperty('/top');},setTop:function(t,f){this.setProperty('/top',t);if(f||f===undefined){this._searchFireQuery();}},getSkip:function(){return this.getProperty('/skip');},setSkip:function(b,f){this.setProperty('/skip',b);if(f||f===undefined){this._searchFireQuery();}},calculatePlaceholder:function(){var b=this;if(b.isAllCategory()){return s.ushell.resources.i18n.getText("search");}else{return s.ushell.resources.i18n.getText("searchInPlaceholder",b.getDataSource().label);}},setFacetVisibility:function(v,f){var b=this;if(v===this.getProperty('/facetVisibility')){return;}if(!v||b.getDataSource().getType().value==='Category'||b.isAppCategory()){b.setProperty('/lastFacetVisibility',v);}this.setProperty('/facetVisibility',v);if(f||f===undefined){this._searchFireQuery();}},getFacetVisibility:function(){return this.getProperty('/facetVisibility');},getDataSource:function(){var b=this;return b.getProperty("/dataSource");},setDataSource:function(d,f,e){var b=this;e=e||{source:""};var o=b.getProperty('/dataSource');var h=false;var r=b.getProperty("/recentDataSources");if(true||e.source==="facets"){for(var i=0,l=r.length;i<l;i++){var j=r[i];if(d.equals(j)){h=true;r.splice(i,Number.MAX_VALUE);b.setProperty("/recentDataSources",r);break;}}if(!h){if(o&&!this.allDataSource.equals(o)&&!this.appDataSource.equals(o)){if(this.tabStripFormatter.tree.hasChild(o,d)){r.push(o);}else{b.setProperty("/recentDataSources",[]);}}}if(this.allDataSource.equals(d)){b.setProperty("/recentDataSources",[]);}}b.resetFilterConditions(false);b.updateDataSourceList(d);b.setProperty("/dataSource",d);b.setProperty("/searchTermPlaceholder",b.calculatePlaceholder());b.setSkip(0,false);if(b.isAppCategory()){b.setTop(b.appTopDefault,false);}else{b.setTop(b.boTopDefault,false);}if(f||f===undefined){b._searchFireQuery();}},updateDataSourceList:function(n){if(n.equals(this.allDataSource)||n.equals(this.appDataSource)){return;}if(n&&n.objectName&&n.objectName.value){if(n.objectName.value.indexOf('~')>=0){return;}}var d=this.getProperty('/dataSources');for(var i=0;i<d.length;++i){var b=d[i];if(b.equals(n)){return;}}d.unshift(n);this.setProperty('/dataSources',d);},resetDataSource:function(f){this.setDataSource(this.allDataSource,f);},getDataSourceJson:function(){var b=this;var d=b.getProperty("/dataSource");var j={"label":d.label,"SchemaName":{"label":d.getSchemaName().label,"value":d.getSchemaName().value},"PackageName":{"label":d.getPackageName().label,"value":d.getPackageName().value},"ObjectName":{"label":d.getObjectName().label,"value":d.getObjectName().value}};if(d.getType().value){j.Type=d.getType().value;}return j;},setDataSourceJson:function(d,f){var b=this.sina.createDataSource(d);this.setDataSource(b,f);},getSearchBoxTerm:function(){var b=this;return b.getProperty("/searchBoxTerm");},setSearchBoxTerm:function(b,f){var d=this;var e=b.replace(/^\s+/,"");d.setProperty("/searchBoxTerm",e);if(e.length===0){return;}if(f||f===undefined){d._searchFireQuery();}},_searchFireQuery:function(){var b=this;if(b.getProperty('/lastSearchTerm')===b.getProperty('/searchBoxTerm')&&b.getProperty('/lastDataSource')===b.getProperty('/dataSource')&&b.getProperty('/lastTop')===b.getProperty('/top')&&b.getProperty('/lastSkip')===b.getProperty('/skip')&&b.getProperty('/lastFacetVisibility')===b.getProperty('/facetVisibility')&&(!b.filterChanged)){return;}if(b.getProperty('/searchBoxTerm').length===0&&b.getProperty('/lastSearchTerm').length!==0){b.setProperty('/searchBoxTerm',b.getProperty('/lastSearchTerm'));}if(b.getProperty('/lastSearchTerm')||b.getProperty('/lastDataSource')){if(b.getProperty('/lastSearchTerm')!==b.getProperty('/searchBoxTerm')||b.getProperty('/lastDataSource')!==b.getProperty('/dataSource')||b.filterChanged){b.setProperty('/skip',0);if(b.isAppCategory()){b.setProperty('/top',b.appTopDefault);}else{b.setProperty('/top',b.boTopDefault);}}}if(b.getProperty('/lastSearchTerm')!==b.getProperty('/searchBoxTerm')){b.tabStripFormatter.markNotSorted();}b.setProperty('/lastSearchTerm',b.getProperty('/searchBoxTerm'));b.setProperty('/lastDataSource',b.getProperty('/dataSource'));b.setProperty('/lastTop',b.getProperty('/top'));b.setProperty('/lastSkip',b.getProperty('/skip'));b.setProperty('/lastFacetVisibility',b.getProperty('/facetVisibility'));b.filterChanged=false;s.ui.getCore().getEventBus().publish("allSearchStarted");b.abortSuggestions();S.abortRequests('search');b.calculateVisibility();this.updateSearchURLSilently();var d=b.getDataSource();jQuery.when.apply(null,[b.normalSearch(),b.appSearch()]).done(function(){b.setProperty('/tabStrips',b.tabStripFormatter.format(d,b.perspective,b));b.setProperty('/facets',b.oFacetFormatter.getFacets(d,b.perspective,b));}).always(function(){s.ui.getCore().getEventBus().publish("allSearchFinished");});},autoStartApp:function(){var b=this;if(b.getProperty("/appCount")&&b.getProperty("/appCount")===1&&b.getProperty("/count")&&b.getProperty("/count")===1){var A=b.getProperty("/appResults");if(A&&A.length>0&&A[0]&&A[0].url&&b.getProperty('/searchBoxTerm')&&A[0].tooltip&&b.getProperty('/searchBoxTerm').toLowerCase().trim()===A[0].tooltip.toLowerCase().trim()){if(A[0].url[0]==='#'){window.location.href=A[0].url;}else{window.open(A[0].url,'_blank');}}}},calculateVisibility:function(){var b=this;if(b.isAppCategory()){b.setProperty('/resultsVisibility',false);b.setProperty('/appsVisibility',true);}else{b.setProperty('/resultsVisibility',true);b.setProperty('/appsVisibility',false);}},appSearch:function(){var b=this;if(b.getSkip()===0){b.setProperty("/appResults",[]);b.setProperty("/appCount",0);}if(b.isAllCategory()||b.isAppCategory()){var t=b.calculateTopAndSkip(b.getTop(),b.getSkip(),b.getProperty('/appResults'));return b.searchApplications(b.getProperty('/searchBoxTerm'),t.top,t.skip).then(function(r){b.setProperty("/appCount",r.totalResults);if(b.getSkip()>0){var d=b.getProperty("/appResults").slice();d.push.apply(d,r.getElements());b.setProperty("/appResults",d);}else{b.setProperty("/appResults",r.getElements());}s.ui.getCore().getEventBus().publish("appSearchFinished",r);},function(){s.ui.getCore().getEventBus().publish("appSearchFinished");return jQuery.when(true);});}else{b.setProperty("/appResults",[]);b.setProperty("/appCount",0);s.ui.getCore().getEventBus().publish("appSearchFinished");}},normalSearch:function(){var b=this;if(b.getSkip()===0){b.setProperty("/boResults",[]);b.setProperty("/boCount",0);}if(b.isBusinessObjSearchEnabled()&&!b.isAppCategory()){b.query.setSearchTerms(b.getSearchBoxTerm());b.query.setDataSource(b.getDataSource());var t=b.calculateTopAndSkip(b.getTop(),b.getSkip(),b.getProperty('/boResults'));b.query.setTop(t.top);b.query.setSkip(t.skip);if((b.getFacetVisibility()&&b.isFacetSearchEnabled())||b.getDataSource().getType().value==='Category'){b.query.setExpand(['Grid','Items','ResultsetFacets','TotalCount']);}else{b.query.setExpand(['Grid','Items','TotalCount']);}return b.query.getResultSet().then(function(p){b.perspective=p;b._afterSearchPrepareResultList(b.perspective,b.getSkip()>0);s.ui.getCore().getEventBus().publish("normalSearchFinished",{append:b.getSkip()>0,resultset:b.perspective});},function(e){s.ui.getCore().getEventBus().publish("normalSearchFinished",{append:b.getSkip()>0,resultset:null});b.normalSearchErrorHandling(e);b.perspective=null;return jQuery.when(true);});}else{b.setProperty("/boResults",[]);b.setProperty("/boCount",0);s.ui.getCore().getEventBus().publish("normalSearchFinished",{append:b.getSkip()>0,resultset:null});}},calculateTopAndSkip:function(t,b,r){var d=r.length;if(r.length>0){var l=r[r.length-1];if(l.type==='footer'){d-=1;}}return{top:b+t-d,skip:d};},normalSearchErrorHandling:function(e){var b=["ESH_FED_MSG016"];if(e){if(e.responseText){var d=true;var f=jQuery.parseJSON(e.responseText);var h='';var j='';if(f.Error){if(f.Error.Message){h+=''+f.Error.Message;}if(f.Error.Code){h+=' (Code '+f.Error.Code+').';}}if(f.ErrorDetails){j+='';for(var i=0;i<f.ErrorDetails.length;i++){j+=f.ErrorDetails[i].Message+' (Code '+f.ErrorDetails[i].Code+')';if(b.indexOf(f.ErrorDetails[i].Code)!==-1){d=false;}}}jQuery.sap.log.error(h+' Details: '+j);if(d){jQuery.sap.require("sap.m.MessageBox");s.m.MessageBox.alert(j,{title:"Search Error: "+h,icon:s.m.MessageBox.Icon.ERROR});}}else{var m='Search error:'+e.toString();jQuery.sap.log.error(m);jQuery.sap.require("sap.m.MessageBox");s.m.MessageBox.alert(m,{title:'Search Error',icon:s.m.MessageBox.Icon.ERROR});}}},_afterSearchPrepareResultList:function(p,b){var d=this;var o=d.getProperty("/boResults");if(b){o.pop();}var f=new a();var r=f.format(p.getSearchResultSet(),this.query.filter.searchTerms);var n=o.concat(r);if(n.length<p.getSearchResultSet().totalcount){var e={};e.type="footer";n.push(e);}d.setProperty("/resultListHeading",s.ushell.resources.i18n.getText("searchResults"));d.setProperty("/boCount",p.getSearchResultSet().totalcount);d.setProperty("/boResults",n);},createSearchURL:function(){var h="#Action-search";h+="&/searchterm="+encodeURIComponent(this.getProperty('/searchBoxTerm'));h+="&datasource="+encodeURIComponent(JSON.stringify(this.getDataSourceJson()));h+="&top="+this.getTop();h+="&skip="+this.getSkip();if(this.getProperty("/filterConditions").length>0){h+="&filter="+encodeURIComponent(JSON.stringify(this.getProperty("/filterConditions")));}return h;},updateSearchURLSilently:function(h){if(!this.updateUrl){return;}h=h||this.createSearchURL();S.hasher.setHash(h);},hashChanged:function(p,f){var P={};jQuery.each(p,function(i,v){P[i.toLowerCase()]=v[0];});if(!P.searchterm){return;}var b=P.searchterm;this.setSearchBoxTerm(b,false);var d;if(P.datasource){var e=JSON.parse(P.datasource);d=this.sina.createDataSource(e);this.setDataSource(d,false);}else{this.resetDataSource(false);}if(P.top){var t=parseInt(P.top);this.setTop(t,false);}if(P.skip){var h=parseInt(P.skip);this.setSkip(h,false);}this.resetFilterConditions(false);if(P.filter){var j=JSON.parse(P.filter);for(var i=0,l=j.length;i<l;i++){var k=new s.ushell.renderers.fiori2.search.FacetItem(j[i]);this.addFilterCondition(k,false);}}if(f||f===undefined){this._searchFireQuery();}},navigateToSearchApp:function(){if(this.getProperty('/searchBoxTerm')===""){return;}var h=this.createSearchURL();window.location.hash=h;}});})(window);
