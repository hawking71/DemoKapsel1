// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(g){"use strict";jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchShellHelper');var s=sap.ushell.renderers.fiori2.search.SearchShellHelper;jQuery.sap.require('sap.ushell.renderers.fiori2.search.controls.SearchFieldGroup');var S=sap.ushell.renderers.fiori2.search.controls.SearchFieldGroup;jQuery.sap.require('sap.ushell.renderers.fiori2.search.controls.SearchBar');jQuery.sap.require('sap.ushell.renderers.fiori2.search.controls.SearchFilterBar');var b=sap.ushell.renderers.fiori2.search.controls.SearchFilterBar;jQuery.sap.require('sap.ushell.renderers.fiori2.search.SearchHelper');var c=sap.ushell.renderers.fiori2.search.SearchHelper;sap.ui.jsview("sap.ushell.renderers.fiori2.search.container.App",{createContent:function(){var a=this;this.oModel=sap.ui.getCore().getModel("searchModel");if(!this.oModel){this.oModel=new sap.ushell.renderers.fiori2.search.SearchModel();sap.ui.getCore().setModel(this.oModel,"searchModel");}this.setModel(sap.ushell.resources.i18nModel,"i18n");this.oFilterBar=new sap.ushell.renderers.fiori2.search.controls.SearchFilterBar();this.oFilterBar.setModel(this.oModel);this.oSearchFieldGroup=new S("searchGroupInApp",{});this.oSearchFieldGroup.setModel(this.oModel);this.oSearchFieldGroup.getAggregation("input").addEventDelegate({onfocusin:function(e){s.closeHeadSearchBox();}},this.oSearchFieldGroup.getAggregation("input"));this.oSearchResults=sap.ui.view({id:"searchContainerResultsView",tooltip:"{i18n>searchResultsView_tooltip}",viewName:"sap.ushell.renderers.fiori2.search.container.Search",type:sap.ui.core.mvc.ViewType.JS});this.oSearchResults.setModel(a.oModel);this.oSearchResults.setAppView(a);this.oSearchResults.searchLayout.setSearchFieldGroup(this.oSearchFieldGroup);this.deserializeURL();this.oPage=this.pageFactory("searchPage",[this.oSearchResults]);a.oSearchResults.searchLayout.initVisibility();return this.oPage;},beforeExit:function(){var a;},deserializeURL:function(){var u=sap.ushell.Container.getService("URLParsing");var a=u.splitHash(window.location.hash).appSpecificRoute;if(!a){return;}var p=u.parseParameters("?"+a.substring(2));this.oModel.hashChanged(p,false);this.oSearchFieldGroup.getAggregation("input").setValue(this.oModel.getProperty('/searchBoxTerm'));if(sap.ui.Device.system.phone){this.oSearchResults.searchLayout.setFacets(null);}else{this.oSearchResults.searchLayout.setFacets(this.oSearchResults.assembleFacets());}this.oModel.setProperty('/lastSearchTerm',null);this.oModel.setProperty('/lastDataSource',null);this.oModel.setProperty('/appResults',[]);this.oModel.setProperty('/boResults',[]);this.oModel._searchFireQuery();},pageFactory:function(i,C,d){var a=this;var o=new sap.ushell.renderers.fiori2.search.controls.SearchBar({oSearchLayout:a.oSearchResults.searchLayout});a.oSearchResults.searchLayout.setFilterBar(a.oFilterBar);var p=new sap.m.Page({id:i,customHeader:o,subHeader:a.oFilterBar,content:C,enableScrolling:true,showFooter:true});a.oSearchResults.searchLayout.setAppPage(p);var e=["onAfterHide","onAfterShow","onBeforeFirstShow","onBeforeHide","onBeforeShow"];var D={};a.createFooter(p);jQuery.each(e,function(I,E){D[E]=jQuery.proxy(function(f){jQuery.each(this.getContent(),function(I,C){C._handleEvent(f);});},p);});p.addEventDelegate(D);if(!sap.ui.Device.system.desktop){p._bUseIScroll=true;}if(d){this.disableBouncing(p);}p.setTitle("{i18n>search}");if(!sap.ui.Device.support.touch){var v=sap.ui.getCore().byId("searchContainerApp");v.addStyleClass('sapUiSizeCompact');}return p;},getControllerName:function(){return"sap.ushell.renderers.fiori2.search.container.App";},createFooter:function(p){var a=this;if(jQuery.device.is.phone){return;}var B=new sap.ushell.ui.footerbar.AddBookmarkButton({beforePressHandler:function(){var h={url:document.URL,title:a.getTileTitleProposal()};B.setAppData(h);}});B.setWidth('auto');var e=new sap.m.Button();e.setIcon("sap-icon://email");e.setText(sap.ushell.resources.i18n.getText("eMailFld"));e.attachPress(function(){sap.m.URLHelper.triggerEmail(null,a.getTileTitleProposal(),document.URL);});e.setWidth('auto');var A=new sap.m.ActionSheet({placement:'Top',buttons:[B,e]});var o=new sap.m.Button({icon:'sap-icon://action',tooltip:sap.ushell.resources.i18n.getText('shareBtn'),press:function(){A.openBy(o);}});var d=new sap.m.Bar({contentRight:[o]});var f=p.getFooter();if(f&&f.destroy){f.destroy();}p.setFooter(d);},getTileTitleProposal:function(){var a=this.oModel.getSearchBoxTerm();var d=this.oModel.getDataSource().label;var t=sap.ushell.resources.i18n.getText('searchTileTitleProposal',[a,d]);return t;}});}(window));
