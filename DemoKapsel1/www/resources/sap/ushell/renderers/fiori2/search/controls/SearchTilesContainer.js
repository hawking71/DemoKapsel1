(function(){"use strict";jQuery.sap.require('sap.m.Button');jQuery.sap.require('sap.ushell.renderers.fiori2.search.controls.SearchTilesContainerKeyHandler');jQuery.sap.require('sap.ushell.renderers.fiori2.search.controls.SearchTileHighlighter');var K=sap.ushell.renderers.fiori2.search.controls.SearchTilesContainerKeyHandler;var T=sap.ushell.renderers.fiori2.search.controls.SearchTileHighlighter;sap.ui.core.Control.extend('sap.ushell.renderers.fiori2.search.controls.SearchTilesContainer',{metadata:{properties:{'tiles':{type:'object',multiple:true},'totalLength':{type:'int',defaultValue:0},'maxRows':{type:'int',defaultValue:1},'highlightTerms':{type:'string',defaultValue:''},'enableKeyHandler':{type:'boolean',defaultValue:true},'tilesPerRow':{type:'int',defaultValue:0},'numberTiles':{type:'int',defaultValue:0},'renderStep':{type:"int",defaultValue:0}},events:{showMore:{}}},constructor:function(){sap.ui.core.Control.prototype.constructor.apply(this,arguments);this.oLpdService=sap.ushell.Container.getService("LaunchPage");if(this.getEnableKeyHandler()){this.addEventDelegate(new K(this));}this.tileHighlighter=new T();},delayedRerender:function(){var s=this;setTimeout(function(){s.rerender();},0);},renderer:function(r,c){var t=c.getTiles();if(!t||t.length===0){return;}r.write('<div');r.writeControlData(c);r.addClass('searchTileContainer');r.writeClasses();r.write('>');c.renderMatrix(r,c);r.write('</div>');},renderMatrix:function(r,c){if(c.getRenderStep()===0){c.renderPlusTile(r,c);}else{c.renderTiles(r,c);}},renderPlusTile:function(r,c){r.write('<div');r.addClass('searchTileWrapper');r.addClass('searchShowMoreTile');r.writeClasses();r.write('>');var b=new sap.m.Button({text:sap.ushell.resources.i18n.getText('showMoreApps'),tooltip:sap.ushell.resources.i18n.getText('showMoreApps'),press:function(){c.fireShowMore();}});r.renderControl(b);r.write('</div>');},renderTiles:function(r,c){var t=c.getTiles();var s=false;var a=0;var o=Math.min(t.length,c.getMaxRows()*c.getTilesPerRow());if(c.getTotalLength()>o){s=true;o=Math.floor((o+1)/c.getTilesPerRow())*c.getTilesPerRow();}for(var i=0;i<o;i++){a++;if(i===o-1&&s){c.renderPlusTile(r,c);break;}var b=t[i];var d=c.oLpdService.getCatalogTileView(b.tile);c.registerAfterRenderingForTile(d);r.write('<div');r.addClass('searchTileWrapper');r.writeClasses();r.writeAttribute("title",sap.ushell.resources.i18n.getText("launchTile_tooltip"));r.write('>');r.renderControl(d);r.write('</div>');}c.setNumberTiles(a);c.tileHighlighter.setHighlightTerms(c.getHighlightTerms());},registerAfterRenderingForTile:function(t){var s=this;t.addEventDelegate({onAfterRendering:function(){s.tileHighlighter.highlight(t);t.getDomRef().children.item(0).setAttribute('tabindex',0);}});},onAfterRendering:function(e){var s=this;var t;if(this.getRenderStep()===0){t=s.calculateTilesPerRow();this.setProperty('tilesPerRow',t,true);this.setProperty('renderStep',1);}else{t=s.calculateTilesPerRow();if(t===this.getTilesPerRow()||t<0){this.setProperty('renderStep',0,true);}else{this.setProperty('renderStep',0);}}$('.searchTileWrapper .sapUshellTileBase').attr('role','button');},highlightTile:function(t){this.tileHighlighter.highlight(t);},getCssProperty:function(e,p){return parseInt(e.css(p),10);},calculateTilesPerRow:function(){var s=this;var c=jQuery(this.getDomRef());var a=c.width();if(c.children.length===0){return-1;}var t=jQuery(c.children().get(0));var m=s.getCssProperty(t,'margin-left');var b=s.getCssProperty(t,'margin-right');var d=m+b;var e=t.outerWidth()+d;var f=4;var g=Math.floor((a-f)/e);return g;},getDynamicNumberTilesPerRow:function(){var c=this.getDomRef();var x=-1;var a=0;for(var i=0;i<c.children.length;++i){var t=c.children.item(i);if(t.offsetLeft<=x){return a;}{a++;x=t.offsetLeft;}}return a;}});})();
