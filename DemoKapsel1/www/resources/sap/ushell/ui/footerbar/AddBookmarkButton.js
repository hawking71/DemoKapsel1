/*!
 * Copyright (c) 2009-2014 SAP SE, All Rights Reserved
 */
jQuery.sap.declare("sap.ushell.ui.footerbar.AddBookmarkButton");jQuery.sap.require("sap.ushell.library");jQuery.sap.require("sap.m.Button");sap.m.Button.extend("sap.ushell.ui.footerbar.AddBookmarkButton",{metadata:{library:"sap.ushell",properties:{"beforePressHandler":{type:"any",group:"Misc",defaultValue:null},"afterPressHandler":{type:"any",group:"Misc",defaultValue:null},"appData":{type:"object",group:"Misc",defaultValue:null}}}});(function(){"use strict";jQuery.sap.require("sap.ui.layout.form.SimpleForm");jQuery.sap.require("sap.m.Label");jQuery.sap.require("sap.m.Input");jQuery.sap.require("sap.m.Dialog");jQuery.sap.require("sap.m.Button");jQuery.sap.require("sap.ushell.resources");jQuery.sap.declare("sap.ushell.ui.footerbar.AddBookmarkButton");sap.ushell.ui.footerbar.AddBookmarkButton.prototype.init=function(){this.setIcon('sap-icon://add-favorite');this.setWidth('100%');this.setText(sap.ushell.resources.i18n.getText("addToHomePageBtn"));this.setTooltip(sap.ushell.resources.i18n.getText("addToHomePageBtn_tooltip"));this.setEnabled();var s=this;this.attachPress(function(){if(s.getBeforePressHandler()){s.getBeforePressHandler()();}s.showAddBookmarkDialog(function(){if(s.getAfterPressHandler()){s.getAfterPressHandler()();}});});if(sap.m.Button.prototype.init){sap.m.Button.prototype.init.apply(this,arguments);}};sap.ushell.ui.footerbar.AddBookmarkButton.prototype.exit=function(){if(this.oDialog){this.oDialog.destroy();}if(sap.m.Button.prototype.exit){sap.m.Button.prototype.exit.apply(this,arguments);}};sap.ushell.ui.footerbar.AddBookmarkButton.prototype.setBookmarkTileView=function(v){this.bookmarkTileView=v;};sap.ushell.ui.footerbar.AddBookmarkButton.prototype.getBookmarkTileView=function(){return this.bookmarkTileView;};sap.ushell.ui.footerbar.AddBookmarkButton.prototype.showAddBookmarkDialog=function(c){this.oResourceBundle=sap.ushell.resources.i18n;this.appData=this.getAppData()||{};var a=this;this.cb=c;var b=sap.ui.view({type:sap.ui.core.mvc.ViewType.JS,viewName:"sap.ushell.ui.footerbar.SaveAsTile",viewData:this.appData});b.enableGroupSelection();this.setBookmarkTileView(b);this.oSimpleForm=new sap.ui.layout.form.SimpleForm({id:'bookmarkFormId',layout:sap.ui.layout.form.SimpleFormLayout.GridLayout,content:[b]}).addStyleClass("sapAddBookmarkForm");var d=this._openDialog(this.oSimpleForm);b.getTitleInput().attachLiveChange(function(){a._toggleOkButton(this.getValue(),d.getBeginButton());});};sap.ushell.ui.footerbar.AddBookmarkButton.prototype._toggleOkButton=function(v,o){o.setEnabled(v?true:false);};sap.ushell.ui.footerbar.AddBookmarkButton.prototype._openDialog=function(c){var o=new sap.m.Button('bookmarkOkBtn',{text:this.oResourceBundle.getText('okBtn'),press:this._handleOkButtonPress.bind(this),enabled:false}),a=new sap.m.Button('bookmarkCancelBtn',{text:this.oResourceBundle.getText('cancelBtn'),press:function(){this.oDialog.close();this.cb();}.bind(this)});this._toggleOkButton(this.appData.title,o);this.oDialog=new sap.m.Dialog({id:'bookmarkDialog',title:this.oResourceBundle.getText('addToHomePageBtn'),contentWidth:'400px',content:c,beginButton:o,endButton:a,horizontalScrolling:false,afterClose:function(){this.oDialog.destroy();delete(this.oDialog);}.bind(this)});this.oDialog.open();return this.oDialog;};sap.ushell.ui.footerbar.AddBookmarkButton.prototype._handleOkButtonPress=function(){var b=this.getBookmarkTileView();var e=sap.ui.getCore().getEventBus();e.publish("launchpad","addBookmarkTile",b.getBookmarkTileData());this.oDialog.close();this.cb();};sap.ushell.ui.footerbar.AddBookmarkButton.prototype.setEnabled=function(e){var s="",p=true;if(sap.ui.getCore().byId("shell")){s=sap.ui.getCore().byId("shell").getModel().getProperty("/currentState").stateName||"";if(sap.ui.getCore().byId("shell").getModel().getProperty("/personalization")!==undefined){p=sap.ui.getCore().byId("shell").getModel().getProperty("/personalization");}}if(s==='headerless'||s==='standalone'||s==='embedded'||!p){e=false;}if(!sap.ushell.Container){if(this.getEnabled()){jQuery.sap.log.warning("Disabling 'Save as Tile' button: unified shell container not initialized",null,"sap.ushell.ui.footerbar.AddBookmarkButton");}e=false;}sap.m.Button.prototype.setEnabled.call(this,e);if(!e){this.addStyleClass("sapUshellAddBookmarkButton");}};}());
